## badNec13MpReplyA.hex
#
# Simon:
#
# We have a NEC 1.3 switch that is giving problems on the Feature Reply.
# We pares through the table features, and working on the “Apply Action”
# getting a bonk as it sees the Action Header length as 8 for the SET_QUEUE
# action, and this does not fit with the expected size of the Action Header
# (4 is  what we are looking for).
#
# I made a test file (included) of the bytes,
### ((Ed: not this file; see badNec13MpReplyC.hex))
# and added it to the “MiscMessageTest” and that is where I am seeing the error
# at the Action Header.
#
# The test hex file for the SetQueueAction seems to be the same thing
# (length of message is 8) so not really sure where to look next.
# Screenshot of running as test included also..
#
# Scott Simes
#
# From the log file:
# [2013-09-24 03:57:27.294] INFO  of-io-47-thread-15           hp.of.ctl
#    Datapath added: 00:00:00:00:00:00:52:40, neg=V_1_3, ip=10.2.37.100
# [2013-09-24 03:57:27.302] WARN  of-io-47-thread-15           hp.of.msglib
#    Parse FAILED: hdr=[V_1_3,MULTIPART_REPLY,576,3245],
#    bytes=[0413024000000cad000c0001000000000230010000000000457870616e6465642
#    0466c6f77205461626c650000000000000000000000000000000000ffffffff000000000
#    000000f00000000000280000000001000010004000200040004000400010008000100040
#    0020005320000000003000514000000000400040000000000050004000000000006005c0
#    000000800000000000f00080000000000110008000000000012000800000000001300080
#    0000000001500080000000000180008000000000019000800000000ffff00180000004c0
#    002000000000000000100080000000000000000000700040000000000080064800000048
#    00005108000070c8000090c80000a0280000c0280000e01800017088000310c80002d088
#    00019088000330c80002f088000140180002a0280001b0480001f0480002304800026018
#    0001d048000210480002504800028018000100100000000000a006480000004800005108
#    000070c8000090c80000a0280000c0280000e01800017088000310c80002d08800019088
#    000330c80002f088000140180002a0280001b0480001f04800023048000260180001d048
#    000210480002504800028018000100100000000000c000400000000000d0004000000000
#    00e0044800006068000080680000c0280000e0180001001800016048000180480001a028
#    0001c0280001e02800020028000341080003610800038048000440480004601000000000
#    00f000400000000fffe000c0000004c0000000200000000ffff000c0000004c000000020
#    0000000]

# The bytes for reals..
0413024000000cad000c0001000000000230010000000000457870616e6465642
0466c6f77205461626c650000000000000000000000000000000000ffffffff000000000
000000f00000000000280000000001000010004000200040004000400010008000100040
0020005320000000003000514000000000400040000000000050004000000000006005c0
000000800000000000f00080000000000110008000000000012000800000000001300080
0000000001500080000000000180008000000000019000800000000ffff00180000004c0
002000000000000000100080000000000000000000700040000000000080064800000048
00005108000070c8000090c80000a0280000c0280000e01800017088000310c80002d088
00019088000330c80002f088000140180002a0280001b0480001f0480002304800026018
0001d048000210480002504800028018000100100000000000a006480000004800005108
000070c8000090c80000a0280000c0280000e01800017088000310c80002d08800019088
000330c80002f088000140180002a0280001b0480001f04800023048000260180001d048
000210480002504800028018000100100000000000c000400000000000d0004000000000
00e0044800006068000080680000c0280000e0180001001800016048000180480001a028
0001c0280001e02800020028000341080003610800038048000440480004601000000000
00f000400000000fffe000c0000004c0000000200000000ffff000c0000004c000000020
0000000

## Analysis:
# Parse exception is:
# com.hp.of.lib.MessageParseException:
#   MsgF:java.nio.HeapByteBuffer[pos=144 lim=576 cap=576]
#   OFM:[V_1_3,MULTIPART_REPLY,576,3245]
#   > com.hp.of.lib.MessageParseException:
#      TFF:java.nio.HeapByteBuffer[pos=144 lim=576 cap=576]
#   > com.hp.of.lib.MessageParseException:
#      AF:java.nio.HeapByteBuffer[pos=144 lim=576 cap=576]
#   > com.hp.of.lib.MessageParseException:
#      AF:java.nio.HeapByteBuffer[pos=144 lim=576 cap=576]
#   Unexpected header length (should be 4): 8

## With the exception for wrong action field length disabled, the message
##  parses as...

# {ofm:[V_1_3,MULTIPART_REPLY,576,3245],TABLE_FEATURES,flgs=[replyMore]}
#
#  -- TABLE FEATURE 0 ----------------
#  Table ID : 1
#  Name : "Expanded Flow Table"
#  Metadata Match : 0xffffffff
#  Metadata Write : 0xf
#  Table Config : []
#  # Max Entries : 163840
#  Table Feature Properties :
#    Property Type : INSTRUCTIONS
#      Supported: [GOTO_TABLE, WRITE_METADATA, APPLY_ACTIONS]
#    Property Type : INSTRUCTIONS_MISS
#      Supported: [GOTO_TABLE]
#    Property Type : NEXT_TABLES
#      Next Tables: [50]
#    Property Type : NEXT_TABLES_MISS
#      Next Tables: [20]
#    Property Type : WRITE_ACTIONS
#      Supported: []
#    Property Type : WRITE_ACTIONS_MISS
#      Supported: []
#    Property Type : APPLY_ACTIONS
#      Supported: [OUTPUT, SET_MPLS_TTL, PUSH_VLAN, POP_VLAN, PUSH_MPLS,
#                   SET_QUEUE, DEC_NW_TTL, SET_FIELD]
#      Experimenter: [{Act:[EXPERIMENTER,len=24],expId=0x4c,
#                   data=0x00020000000000000001000800000000}]
#    Property Type : APPLY_ACTIONS_MISS
#      Supported: []
#    Property Type : MATCH
#      IN_PORT, METADATA{maskable}, ETH_DST{maskable}, ETH_SRC{maskable},
#       ETH_TYPE, VLAN_VID, VLAN_PCP, IP_DSCP, IP_PROTO,
#       IPV4_SRC{maskable}, IPV4_DST{maskable},
#       TCP_SRC{maskable}, TCP_DST{maskable},
#       UDP_SRC{maskable}, UDP_DST{maskable},
#       SCTP_SRC{maskable}, SCTP_DST{maskable},
#       ICMPV4_TYPE, ICMPV4_CODE, ARP_OP,
#       ARP_SPA{maskable}, ARP_TPA{maskable},
#       ARP_SHA{maskable}, ARP_THA{maskable}
#    Property Type : WILDCARDS
#      IN_PORT, METADATA{maskable}, ETH_DST{maskable}, ETH_SRC{maskable},
#       ETH_TYPE, VLAN_VID, VLAN_PCP, IP_DSCP, IP_PROTO,
#       IPV4_SRC{maskable}, IPV4_DST{maskable},
#       TCP_SRC{maskable}, TCP_DST{maskable},
#       UDP_SRC{maskable}, UDP_DST{maskable},
#       SCTP_SRC{maskable}, SCTP_DST{maskable},
#       ICMPV4_TYPE, ICMPV4_CODE, ARP_OP,
#       ARP_SPA{maskable}, ARP_TPA{maskable},
#       ARP_SHA{maskable}, ARP_THA{maskable}
#    Property Type : WRITE_SETFIELD
#      (none)
#    Property Type : WRITE_SETFIELD_MISS
#      (none)
#    Property Type : APPLY_SETFIELD
#      ETH_DST, ETH_SRC, VLAN_VID, VLAN_PCP, IP_DSCP,
#       IPV4_SRC, IPV4_DST, TCP_SRC, TCP_DST, UDP_SRC, UDP_DST,
#       IPV6_SRC, IPV6_DST, IPV6_FLABEL, MPLS_LABEL, MPLS_TC
#    Property Type : APPLY_SETFIELD_MISS
#      (none)
#    Property Type : EXPERIMENTER
#      Exp. ID: 0x4c
#      Exp. defined type: 2
#    Property Type : EXPERIMENTER_MISS
#      Exp. ID: 0x4c
#      Exp. defined type: 2
#-----------
