### OpenFlow 1.3 FLOW MOD message
#
# openflow version (u8) = 1.3 (0x4)
#<0>#
04

# message type (u8) = OFPT_FLOW_MOD(14)
0e

# message length (u16) = 160
00 a0

# transaction id (u32) = 0
00 00 00 00

### Message Specific Payload
# cookie (u64) = 0x1234
#<8>#
0000 0000 0000 1234

# cookie mask (u64) = 0xffff
#<16>#
0000 0000 0000 ffff

## now the Flow Actions
# table id (u8) - the table in which to put the flow = 3
#<24>#
03

# flow mod command (u8) = ADD(0)
00

# idle timeout in seconds (u16) = 30
00 1e

# hard timeout in seconds (u16) = 300 (5 minutes)
01 2c

# priority (u16) = 64
00 40

# buffer id (u32) = 7
#<32>#
00 00 00 07

# out port (u32) = ANY
ff ff ff ff

# out group (u32) = ANY
#<40>#
ff ff ff ff

# flow mod flags (u16)
## SEND_FLOW_REM   (0x1)
## CHECK_OVERLAP   (0x2)
## NO_BYTE_COUNTS (0x10)
00 13

# padding (u8 x 2)
00 00

#########  Match Structure  ##########
## Match Header
# Type (u16) = OXM (0x1)
#<48>#
00 01
# Length (u16) = 37 (excludes padding)
00 25

## Match Field - Ethernet Source Address w/Mask
# Basic, ETH_SRC(4<<1)+M, len
#<52>#
  8000   09               0c
# Source MAC           Mask
  11 22 33 44 55 66    ff ff ff 00 00 00

## Match Field - Ethernet Type (IPv4)
# Basic, ETH_TYPE(5<<1), len
#<68>#
  8000   0a              02
# IPv4
  0800

## Match Field - IP Protocol (TCP)
# Basic, IP_PROTO(10<<1), len
#<74>#
  8000   14               01
# TCP
  06

## Match Field - TCP Destination Port (25 - SMTP)
# Basic, TCP_DST(14<<1), len
#<79>#
  8000   1c              02
# SMTP (25)
  00 19

## Zero-Filled Padding to bring total structure length to multiple of 8
## Match struct length is 37; add 3 to bring it to 40
#<85>#
00 00 00

#########  List of Instructions ##########

#==============
# WRITE_METADATA
#==============

## HEADER
# Instruction Type (u16) : WRITE_METADATA = 2
#<88>#
00 02

# Length of struct (u16) = 24
00 18

## INSTRUCTION SPECIFIC
# Pad to 64-bit boundary (u8 x 4)
00 00 00 00

# Metadata (u64) = 0x12340000
#<96>#
0000 0000 abcd 0000

# Metadata mask (u64) = 0xffff0000
#<104>#
0000 0000 ffff 0000

#==============
# APPLY_ACTIONS
#==============

## HEADER
# Instruction Type (u16) : APPLY_ACTIONS = 4
#<112>#
00 04

# Length of struct (u16) = 48
00 30

## INSTRUCTION SPECIFIC
# Pad to 64-bit boundary (u8 x 4)
00 00 00 00

#### Action List Goes Here

#.............
# DEC_NW_TTL
#.............
# Action Type (u16), Length (u16), Action Specific
# DEC_NW_TTL(24),    8,            padding
#<120>#
  00 18              00 08         00 00 00 00

#.............
# SET_FIELD.ETH_DST
#.............
# Action Type (u16), Length (u16), Action Specific
# SET_FIELD(25),     16,           Single OXM TLV
#<128>#
  00 19              00 10
# Class (u16), Field+M (u8),    Payload Length (u8)
# Basic        ETH_DST(3<<1)    6
  8000         06               06
## Payload : Destination MAC address (u48)
#<136>#
00 00 1e 45 34 11
#### Pad to 64-bits
00 00


#.............
# SET_FIELD.IPV4_DST
#.............
# Action Type (u16), Length (u16), Action Specific
# SET_FIELD(25),     16,           Single OXM TLV
#<144>#
00 19                00 10
# Class (u16), Field+M (u8),    Payload Length (u8)
# Basic        IPV4_DST(12<<1)  4
  8000         18               04
## Payload : Destination IPv4 address (u32) = 15.254.17.1
#<152>#
0f fe 11 01
#### Pad to 64-bits
00 00 00 00

#<160>#
#### and we are done ####
